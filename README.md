# _Support library_ for using De Bruijn levels (version 1.0)

## Introduction

_De Bruijn levels_ is a representation of variable in the lambda-calculus that avoid variable capture. Although this representation is much less known than the _De Bruijn indices_ representation, there are some useful characteristics.

Extract from another work, here is a collection of interfaces, implementations and functions that can help you in yours use of De Bruijn levels.
<!--
## Documentation

Here is the current version of the [documentation](/home/lifo/Bureau/Doctorat/[GIT]_tji/formalisations/DeBrLevel/doc/html/toc.html "current documentation"). This doc is generated by [coqdoc](https://coq.inria.fr/refman/using/tools/coqdoc.html "official documentation of Coq") with the extension [coqdocjs](https://github.com/coq-community/coqdocjs "github of coqdocjs").
-->
## De Bruijn Levels

In a lambda calculus term we have variables (`x`,`y`,`z`, ...) that can be _bound_ or _free_. In a term `t`, we state that a variable `x` is _free_ if there is no abstraction that use this variable name, otherwise the variable is _bound_.

```ocaml
(* x is bind to the abstraction while y is free *)
fun x -> x + y
```

__How to interpret the following term ?__

```ocaml
fun x -> x + ((fun x -> x + x) 3)
```

We have a capture of variable above because `x` can be the bound to the outer abstraction or the inner one. In most of the languages the inner one is privileged. Now what if we write the following term ?

```ocaml
x + ((fun x -> x + x) 3)
```

`x` is a free variable outside the abstraction and a bind variable inside. How to deal with this ? We will use representation to avoid this kind of issue. __De Bruijn representation__ define a term as a tree were application will split the branch in two and abstraction will increment the level.

```ocaml
(*
The following example have the following tree:

--------------------------------------------------------------

  fun y -> (y  ((fun x -> x z) (fun y -> y)))      1
                        |
--------------------------------------------------------------
                        |
      (y  ((fun x -> x z) (fun y -> y)))           
           /               \                      
          |                 |
          y        ((fun x -> x z) (fun y -> y))   2
                     /                   \
                    |                     |
              (fun x -> x z)         (fun y -> y)  
--------------------------------------------------------------
                    |                     |
                   x z                    y
                  /   \                             3
                 |     |
                 x     z
*)
fun y -> (y  ((fun x -> x z) (fun y -> y)))
```

Now, bind variable would be the level of the abstraction and consequently the abstraction does not need to explicit its bind variable anymore. Thus, the following example will be written as follows:

```ocaml
fun -> (0 ((fun -> 1 0) (fun -> 1)))
```

There are a numerous way to represent lambda calculus but the __De Bruijn level representation__ is very simple to use, contrary to the _De Bruijn indices representation_ the term is still easy to read, and this representation handles free variables simply by shift the base level.
<!--
## Updates

### February 28, 2024

We simplify the use of map by adding `Make` module for each possible `Map`. On top of that, a new map with basic keys and leveled data is implemented.

Here are the details:

- [MapLevelInterface](theories/Interface/MapLevelInterface.v) has new interfaces named `ShiftValidMapDETInterface`, `StrongShiftValidMapDETInterface`, `ShiftValidFullMapDETInterface` and `StrongShiftValidFullMapDETInterface`. Those maps have basic keys and leveled data. The only requirement on __keys__ is that __they have to be ordered__.
- An implementation of two among the four new interfaces are findable in [MapETLevel](theories/Implementation/MapETLevel.v)
- For an easier use of map modules, `Make` modules are findable in [MapETLevel](theories/Implementation/MapETLevel.v). Those `Make` modules only ask the key type and the data type.
- Internal module `OP.P` in `Map` is now directly included in the main module when instantiated with a `Make` module.
- __Removing `MapOTLevel` and its interface__.

### February 23, 2024

`Map` interfaces and implementations required elements that implemented `OrderedType`. For an easier use of its, this required property has been weakened and now requires `EqualityType`. Thus, there is modification mainly in `Map` interfaces and implementations but also in the `Level` interface and the `PairLevel` implementation.
On top of that, most of the module type names for `Map` have _changed_.

Here are the details:

- `MapLevel` is now split in two files [MapETLevel](theories/Implementation/MapETLevel.v) and [MapOTLevel](theories/Implementation/MapOTLevel.v) as follows:
  - [MapETLevel](theories/Implementation/MapETLevel.v) contains all implementation with data that implements `EqualityType`
  - [MapOTLevel](theories/Implementation/MapOTLevel.v) contains all implementation with data that implements `OrderedType`
- `MapOT` and `MapOTInterface` are now [MapExt](theories/Mapkit/MapExt.v) and [MapExtInterface](theories/Mapkit/MapExtInterface.v)
- [LevelInterface](theories/Interface/LevelInterface.v) contains new module types for elements that implements `DecidableType` and `EqualityType`. Also, the __minimum constraint for elements__ that used those module types are now the constraint of `EqualityType`.
- In [MapETLevel](theories/Implementation/MapETLevel.v), [MapOTLevel](theories/Implementation/MapOTLevel.v), [MapLevelInterface](theories/Interface/MapLevelInterface.v), [SetLevelInterface](theories/Interface/SetLevelInterface.v) and [SetLevel](theories/Implementation/SetLevel.v), the extension name __`WithLeibniz`__ is now contracted in __`WL`__
- In [PairLevel](theories/Implementation/PairLevel.v), there is now several implementations for `EqualityType` and `OrderedType` elements
- In [MapOTLevel](theories/Implementation/MapOTLevel.v) and [MapLevelInterface](theories/Interface/MapLevelInterface.v), the extension name __`Data`__ is now contracted in __`D`__
- Documentation is not updated for now
-->
## Installation instructions

To Build and install manually, do:

```bash
git clone https://github.com/JordanIschard/DeBrLevel.git

cd DeBrLevel
dune build @install 
```

> [!NOTE]
> The package is not submitted yet, but we have great hope to create an opam package and add our project to the [coq community repository](https://github.com/coq-community).

<!--
## Structure of the library

### DeBrLevel

- [doc/](/doc)
  - [resources/](/doc/resources)
    - [config.js](/doc/resources/config.js)
    - [coqdoc.css](/doc/resources/coqdoc.css)
    - [coqdocjs.css](/doc/resources/coqdocjs.css)
    - [coqdocjs.js](/doc/resources/coqdocjs.js)
    - [footer.html](/doc/resources/footer.html)
    - [header.html](/doc/resources/header.html)
- [etc/](/etc)
  - [generate_coqproject.sh](/etc/generate_coqproject.sh)
- [theories/](/theories)
  - [Core/](/theories/Core)
    - [Level.v](/theories/Core/Level.v)
    - [LevelInterface.v](/theories/Core/LevelInterface.v)
  - [Datatype/](/theories/Datatype)
    - [OptionLevel.v](/theories/Datatype/OptionLevel.v)
    - [PairLevel.v](/theories/Datatype/PairLevel.v)
  - [List/](/theories/List)
    - [ListLevel.v](/theories/List/ListLevel.v)
    - [StreamLevel.v](/theories/List/StreamLevel.v)
  - [Map/](/theories/Map)
    - [Mapkit/](/theories/Map/Mapkit)
      - [MapExt.v](/theories/Map/Mapkit/MapExt.v)
      - [MapExtInterface.v](/theories/Map/Mapkit/MapExtInterface.v)
    - [Maps/](/theories/Map/Maps)
      - [MapD.v](/theories/Map/Maps/MapD.v)
      - [MapK.v](/theories/Map/Maps/MapK.v)
      - [MapKD.v](/theories/Map/Maps/MapKD.v)
      - [MapLvl.v](/theories/Map/Maps/MapLvl.v)
      - [MapLvlD.v](/theories/Map/Maps/MapLvlD.v)
    - [MapLevel.v](/theories/Map/MapLevel.v)
    - [MapLevelInterface.v](/theories/Map/MapLevelInterface.v)
  - [Set/](/theories/Set)
    - [Setkit/](/theories/Set/Setkit)
      - [SetOTwL.v](/theories/Set/Setkit/SetOTwL.v)
      - [SetOTwLInterface.v](/theories/Set/Setkit/SetOTwLInterface.v)
    - [Levels.v](/theories/Set/Levels.v)
    - [SetLevel.v](/theories/Set/SetLevel.v)
    - [SetLevelInterface.v](/theories/Set/SetLevelInterface.v)
- [Makefile](/Makefile)
- [Makefile.coq.local](/Makefile.coq.local)
- [README.md](/README.md)
- [coq-debr-lvl.opam](/coq-debr-lvl.opam)
- [dune](/dune)
- [dune-project](/dune-project)

## Authors

- Jordan Ischard

-->